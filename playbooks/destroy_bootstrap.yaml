---
- name: OKD Destroy | Bootstrap
  hosts: '{{ target|default("localhost") }}'
  connection: local

  tasks:
    - name: EC2 | Destroying instance(s)
      amazon.aws.ec2_instance:
        state: absent
        filters:
          "tag:Name": "{{ machine.name }}"
          instance-state-name: running
        wait: "{{ machine.wait | d('no') }}"
        wait_timeout: "{{ machine.wait_timeout | d(omit) }}"
      with_items:
        - name: "{{ cluster_state.infra_id }}-bootstrap"
          wait: yes
          wait_timeout: 120
      loop_control:
        loop_var: machine
