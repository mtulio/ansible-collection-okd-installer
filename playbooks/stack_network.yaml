---
# - ansible.builtin.import_playbook: var_check_required.yaml

- name: OKD Stack Network | Config load
  ansible.builtin.import_playbook: config.yaml
  vars:
    mode: load

- name: OKD Stack Network
  hosts: '{{target|default("localhost")}}'
  connection: local

  pre_tasks:
    - name: Include User Provided Network Variables
      ansible.builtin.include_vars:
        file: "{{ var_file }}"
      when: var_file is defined

    - name: Include Network Variables - Pre-build topologies
      ansible.builtin.include_vars:
        file: "./vars/{{ provider }}/topologies/{{ topology_network }}/network.yaml"
      when: topology_network is defined

    - name: Include Network Variables - Default
      ansible.builtin.include_vars:
        file: "./vars/{{ provider }}/network.yaml"
      when: cloud_networks is not defined

  roles:
    - cloud_network

- name: OKD Stack Network | Save state
  ansible.builtin.import_playbook: config.yaml
  vars:
    mode: save-state
    cluster_state: "{{ cluster_state | combine({'network': cloud_networks_state}) }}"
