--- # Setup Ignition files for Bootstrap in AWS

- name: DigitalOcean | Create Spaces
  community.digitalocean.digital_ocean_spaces:
    state: present
    name: "{{ openshift_bootstrap_bucket }}"
    #region: "{{ ocp_config_region }}"
    region: "{{ cluster_state.region }}"
  register: do_space

- name: DigitalOcean | Show Config
  debug:
    var: do_space

- name: DigitalOcean | Set Bucket URL
  set_fact:
    openshift_bootstrap_bucket_url: "{{ do_space.data.space.endpoint_url }}"

- name: DigitalOcean | Upload bootstrap.ign
  amazon.aws.aws_s3:
    bucket: "{{ openshift_bootstrap_bucket }}"
    object: "/bootstrap.ign"
    src: "{{ install_dir + '/bootstrap.ign' }}"
    mode: put
    s3_url: "{{ openshift_bootstrap_bucket_url | d(omit) }}"
  register: s3_put

- name: DigitalOcean | Show pre-signed URL
  debug:
    var: s3_put

- name: DigitalOcean | Set the Ignition URL
  set_fact:
    setup_bootstrap_ign_spaces_url: "{{ s3_put.url }}"
